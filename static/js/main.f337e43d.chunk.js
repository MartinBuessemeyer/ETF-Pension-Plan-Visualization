(this["webpackJsonpetf-vis"]=this["webpackJsonpetf-vis"]||[]).push([[0],{159:function(t,e,a){},160:function(t,e,a){},163:function(t,e,a){"use strict";a.r(e);var n=a(7),r=a.n(n),i=a(49),s=a.n(i),o=(a(159),a(160),a(2)),c=a.n(o),u=a(5),l=a(8),d=a(9),h=a(15),v=a(27),f=a(31),p=a(11),m=a(0),g=a(6),y=a(30),b=a.n(y),x=a(4),P=864e5,j=12;function S(t){return 0===t.getMonth()}function C(t,e){return O.apply(this,arguments)}function O(){return(O=Object(p.a)(c.a.mark((function t(e,a){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.c("https://www.alphavantage.co/query?function=TIME_SERIES_MONTHLY_ADJUSTED&symbol=".concat(e,"&apikey=").concat(a,"&datatype=csv"),(function(t){return{date:new Date(t.timestamp.toString()),dividend:parseFloat(t["dividend amount"]),course:parseFloat(t["adjusted close"])}}));case 2:return(n=t.sent).sort((function(t,e){return t.date-e.date})),t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function T(t){return t.map((function(t){return[F(t.date),t.course]}))}function w(t){var e=t[0].date.getFullYear(),a=[[e,0]];return t.forEach((function(t){t.date.getFullYear()===e?a[a.length-1][1]+=t.dividend:(e=t.date.getFullYear(),a.push([e,t.dividend]))})),a.sort((function(t,e){return t[0]-e[0]})),a}function F(t){return Math.floor(t.getTime()/P)}function M(t){this.message="First call loadHistoricalDataIfNotPresent() before predicting: ".concat(t),this.name="HistoricalDataNotPresentException"}var k=function(){function t(){Object(l.a)(this,t),this.historicalData={},this.coursePredictors={},this.dividendPredictors={}}return Object(d.a)(t,[{key:"loadAndCacheHistoricalETFData",value:function(){var e=Object(p.a)(c.a.mark((function e(a){var n,r,i,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a in this.historicalData)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,C(a);case 4:n=e.sent,r=T(n),i=t._calculateMaxTimestampBeforePredictorRepetition(r),s=w(n),o=t._calculateMaxTimestampBeforePredictorRepetition(s),this.historicalData[a]={history:n,courseForecastArray:r,dividendForecastArray:s},this.coursePredictors[a]={maxTimestampBeforeCoursePredictorRepetition:i},this.dividendPredictors[a]={maxYearBeforeDividendPredictorRepetition:o};case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCoursePredictorIfNotPresent",value:function(e,a){if(!(a in this.coursePredictors[e])){var n=this.historicalData[e].courseForecastArray,r=n[n.length-1][0]-Math.abs(n[n.length-1][0]-a)*t.backCastTimeFactor-t.backCastTimestampConstant,i=n.filter((function(t){return t[0]>=r}));this.coursePredictors[e][a]=b.a.linear(i,{order:2,precision:20})}}},{key:"_courseDateToPredictorTimestampAndDateTimestamp",value:function(t,e){var a=F(t);return[a>this.coursePredictors[e].maxTimestampBeforeCoursePredictorRepetition?this.coursePredictors[e].maxTimestampBeforeCoursePredictorRepetition:a,a]}},{key:"_createDividendPredictorIfNotPresent",value:function(e,a){if(!(a in this.dividendPredictors[e])){var n=this.historicalData[e].dividendForecastArray,r=n[n.length-1][0]-Math.abs(n[n.length-1][0]-a)*t.backCastTimeFactor-t.backCastTimestampConstant,i=n.filter((function(t){return t[0]>=r}));this.dividendPredictors[e][a]=b.a.linear(i,{order:2,precision:20})}}},{key:"_dividendYearToPredictorYear",value:function(t,e){return this.dividendPredictors[t].maxYearBeforeDividendPredictorRepetition<e?this.dividendPredictors[t].maxYearBeforeDividendPredictorRepetition:e}},{key:"predictCourse",value:function(t,e){if(!(t in this.coursePredictors))throw new M(t);var a=this._courseDateToPredictorTimestampAndDateTimestamp(e,t),n=Object(g.a)(a,2),r=n[0],i=n[1];return this._createCoursePredictorIfNotPresent(t,r),this.coursePredictors[t][r].predict(i)[1]}},{key:"predictDividend",value:function(t,e){if(!(t in this.dividendPredictors))throw new M(t);var a=this._dividendYearToPredictorYear(t,e);return this._createDividendPredictorIfNotPresent(t,a),Math.max(0,this.dividendPredictors[t][a].predict(e)[1])}}],[{key:"configure",value:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7;t.apiKey=e,t.backCastTimeFactor=a;var r=new Date(0);if(r.setMonth(n),t.backCastTimestampConstant=F(r),null!=t.instance){var i=t.getInstance();for(var s in i.coursePredictors)i.coursePredictors[s]={maxTimestampBeforeCoursePredictorRepetition:t._calculateMaxTimestampBeforePredictorRepetition(i.historicalData[s].courseForecastArray)};for(var o in i.dividendPredictors)i.dividendPredictors[o]={maxYearBeforeDividendPredictorRepetition:t._calculateMaxTimestampBeforePredictorRepetition(i.historicalData[o].dividendForecastArray)}}}},{key:"getInstance",value:function(){return null==t.instance&&(t.instance=new t),t.instance}},{key:"_calculateMaxTimestampBeforePredictorRepetition",value:function(e){var a=e[0][0],n=e[e.length-1][0];return n+(n-a)/t.backCastTimeFactor}}]),t}();k.instance=null,k.apiKey=null,k.backCastTimeConstant=null,k.backCastTimeFactor=null;var I=k,D=a(1),_=.26375;function R(t){var e=new Date(t);return e.setMonth(t.getMonth()+1),e}function N(t,e){return function(t){return 11===t.getMonth()}(e)?I.getInstance().predictDividend(t,e.getFullYear()):0}function A(t,e){var a=t*e.percentageCosts+e.fixedCosts,n=Math.max(t-a,0);return[n,a=t-n]}function Y(t,e){return[Math.max(0,t-e),Math.max(0,e-t)]}function B(t,e){return e.totalShares[t]*e.sharePrizes[t]}function z(t,e){return e.newShares[t]*e.sharePrizes[t]}function E(t,e,a,n,r){var i=I.getInstance(),s=0,o=t[t.length-1],c={date:a,newShares:{},totalShares:Object(u.a)({},o.totalShares),dividendNewShares:{},dividendTotalShares:Object(u.a)({},o.dividendTotalShares),totalCosts:o.totalCosts,sharePrizes:{},totalInvestedMoney:Object(u.a)({},o.totalInvestedMoney),totalTaxes:o.totalTaxes,totalPayout:Object(u.a)({},o.totalPayout),newPayout:{}};for(var l in n){var d=A(n[l]*e,r.costConfig),h=Object(g.a)(d,2),v=h[0];s+=h[1],c.totalInvestedMoney[l]+=v;var f=i.predictCourse(l,a),p=v/f;c.sharePrizes[l]=f,c.newShares[l]=p;var m=N(l,a),y=c.totalShares[l]*m/f;c.newShares[l]+=y,c.dividendNewShares[l]=y,c.dividendTotalShares[l]+=y,c.totalShares[l]+=c.newShares[l],c.newPayout[l]=0}c.totalCosts+=s;var b=function(t,e,a,n){if(!S(e)||t.length<2)return[0,a];var r,i,s,o=0,c=t[t.length-1],u=t.length-j>1?t[t.length-j]:t[1];for(var l in n){for(var d=0,h=1;h<j&&t.length-h>0;h++)d+=z(l,t[t.length-h])*h/j;d+=B(l,u)*(j-u.date.getMonth())/j,d*=.0049;var v=B(l,c)-c.totalInvestedMoney[l],f=0;t.length>j&&(f=Math.max(0,B(l,t[t.length-1-j])-t[t.length-1-j].totalInvestedMoney[l]));var p=(r=v-f,i=0,s=d,Math.max(i,Math.min(r,s))),m=Y(p,a),y=Object(g.a)(m,2);p=y[0],a=y[1],o+=.7*p*_}return[o,a]}(t,a,r.taxFreeAmount,n),x=Object(g.a)(b,2),P=x[0],C=x[1];return c.totalTaxes+=P,t.push(c),C}function L(t,e,a,n,r,i,s,o){S(n)&&(s=r.taxFreeAmount);var c=I.getInstance(),l=0,d=0,h=t[t.length-1],v={date:n,newShares:{},totalShares:Object(u.a)({},h.totalShares),dividendNewShares:{},dividendTotalShares:Object(u.a)({},h.dividendTotalShares),totalCosts:h.totalCosts,sharePrizes:{},totalInvestedMoney:Object(u.a)({},h.totalInvestedMoney),totalTaxes:h.totalTaxes,totalPayout:Object(u.a)({},h.totalPayout),newPayout:{}};for(var f in a){var p=c.predictCourse(f,n);if(v.sharePrizes[f]=p,v.newPayout[f]=0,o[f].investmentStepsIdx<t.length){for(var m=e*a[f],y=0,b=A(m,r.costConfig)[1],x=0,P=o[f].investmentStepsIdx,j=t[P].newShares[f]-o[f].alreadySoldShares;P<t.length;P++){var C=m-y,O=t[P],T=p*(P===o[f].investmentStepsIdx?O.newShares[f]-o[f].alreadySoldShares:O.newShares[f]),w=Math.min(T,C),F=w/p;j=O.newShares[f]-F,j-=P===o[f].investmentStepsIdx?o[f].alreadySoldShares:0;var M=Math.max(0,w-(b-x));x+=Math.max(0,w-M);var k=F*O.sharePrizes[f],D=Math.max(0,M-k),R=Y(D,s),B=Object(g.a)(R,2);D=B[0],s=B[1];var z=.7*D*_,E=Y(z,i),L=Object(g.a)(E,2);z=L[0],i=L[1],d+=z;var H=M-z;v.newPayout[f]+=H,v.totalPayout[f]+=H,v.totalShares[f]-=F,y+=w;var V=0;V=P===o[f].investmentStepsIdx?Math.max(0,O.dividendNewShares[f]-o[f].alreadySoldShares):O.dividendNewShares[f];var J=Math.min(V,F);if(v.dividendTotalShares[f]-=J,y>=m)break}l+=x,o[f].investmentStepsIdx=P,o[f].investmentStepsIdx+=0===j?1:0,o[f].alreadySoldShares=P<t.length?t[P].newShares[f]-j:0}var U=v.totalShares[f]*N(f,n)/p;v.newShares[f]=U,v.totalShares[f]+=U,v.dividendNewShares[f]=U,v.dividendTotalShares[f]+=U}return v.totalCosts+=l,v.totalTaxes+=d,t.push(v),[i,s]}function H(t,e){var a=I.getInstance(),n={date:e,totalCosts:0,totalTaxes:0,newShares:{},totalShares:{},dividendNewShares:{},dividendTotalShares:{},totalInvestedMoney:{},totalPayout:{},newPayout:{},sharePrizes:{}};for(var r in t)n.newShares[r]=0,n.totalShares[r]=0,n.dividendNewShares[r]=0,n.dividendTotalShares[r]=0,n.totalInvestedMoney[r]=0,n.totalPayout[r]=0,n.newPayout[r]=0,n.sharePrizes[r]=a.predictCourse(r,e);return n}var V,J=function(){function t(e,a,n,r,i,s,o,c){Object(l.a)(this,t),this.startCapital=e,this.monthlyInvestment=a,this.monthlyPayout=n,this.savingPhaseLength=r,this.etfToRatio=i,this.configOptions=s,this.expectationOfLife=c,this.age=o,this._calculateTimestampsForModel(),this._calculateModel()}return Object(d.a)(t,[{key:"_calculateTimestampsForModel",value:function(){for(var t=function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,r=e-t,i=new Date,s=new Date(i.getFullYear(),i.getMonth()+1),o=new Date(s);o.setFullYear(s.getFullYear()+a);var c=new Date(s);return c.setFullYear(s.getFullYear()+r+n),[s,o,c]}(this.age,this.expectationOfLife,this.savingPhaseLength),e=Object(g.a)(t,3),a=e[0],n=e[1],r=e[2],i=[],s=a;s<n;s=R(s))i.push(s);this.savingDates=i;for(var o=[],c=n;c<r;c=R(c))o.push(c);this.payoutDates=o}},{key:"_calculateModel",value:function(){var t,e=[H(this.etfToRatio,this.savingDates[0])],a=E(e,this.monthlyInvestment+this.startCapital,this.savingDates[0],this.etfToRatio,this.configOptions),n=Object(D.a)(this.savingDates.slice(1));try{for(n.s();!(t=n.n()).done;){var r=t.value;a=E(e,this.monthlyInvestment,r,this.etfToRatio,this.configOptions)}}catch(v){n.e(v)}finally{n.f()}var i=(e=e.slice(1))[e.length-1].totalTaxes,s={};for(var o in this.etfToRatio)s[o]={investmentStepsIdx:0,alreadySoldShares:0};var c,u=Object(D.a)(this.payoutDates);try{for(u.s();!(c=u.n()).done;){var l=c.value,d=L(e,this.monthlyPayout,this.etfToRatio,l,this.configOptions,i,a,s),h=Object(g.a)(d,2);i=h[0],a=h[1]}}catch(v){u.e(v)}finally{u.f()}this.investmentSteps=e}}]),t}(),U=function(){function t(){Object(l.a)(this,t)}return Object(d.a)(t,[{key:"render",value:function(t,e){e.innerHTML="";var a=x.j(e).append("svg").attr("id","firstSVG").attr("height","100%").attr("width","100%").attr("viewBox","0 0 ".concat(1300," ").concat(480)).append("g").attr("transform","translate(".concat([150,40],")")),n={costs:0,taxes:1,inflation:2},r=3,i="capital",s="dividend";for(var o in t[0].totalShares)n[o+s]=r++,n[o+i]=r++;for(var c=[],u=0;u<r;u++)c.push([]);var l,d=Object(D.a)(t);try{for(d.s();!(l=d.n()).done;){var h=l.value;c[n.costs].push({value:-h.totalCosts,date:h.date}),c[n.taxes].push({value:-h.totalCosts-h.totalTaxes,date:h.date}),c[n.inflation].push({value:-h.totalCosts-h.totalTaxes,date:h.date});var v=0;for(var f in h.totalShares){var p=B(f,h),m=h.dividendTotalShares[f]*h.sharePrizes[f];c[n[f+i]].push({value:p+v,date:h.date}),c[n[f+s]].push({value:p-m+v,date:h.date}),v+=p}}}catch(O){d.e(O)}finally{d.f()}for(var g in c[n.inflation].cssClass="inflation",c[n.taxes].cssClass="taxes",c[n.costs].cssClass="costs",t[0].totalShares)c[n[g+s]].cssClass="".concat(g,"_dividend"),c[n[g+i]].cssClass="".concat(g,"_total_amount");var y=x.g(c[n.inflation].map((function(t){return t.value}))),b=x.f(c[c.length-1].map((function(t){return t.value}))),P=x.h().domain([y,b]).range([400,0]),j=x.d(c[0],(function(t){return t.date})),S=x.i().domain(j).range([0,1e3]);a.append("g").style("font-size","20px").call(x.b(P).tickFormat((function(t){return"".concat(t.toLocaleString()," EUR")}))),a.append("g").style("font-size","20px").attr("transform","translate(0, ".concat(400,")")).call(x.a(S)),a.append("g").append("line").attr("x1",S(j[0])).attr("y1",P(0)).attr("x2",S(j[1])).attr("y2",P(0)).attr("stroke-width",3).attr("stroke","black");for(var C=0;C<c.length;C++)a.append("path").datum(c[C]).attr("fill","none").attr("class",(function(t){return t.cssClass})).attr("stroke-width",3).attr("d",x.e().x((function(t){return S(t.date)})).y((function(t){return P(t.value)})))}}]),t}(),K=a(3),q="startingCapital",G="monthlyInvestment",Q="transactionCosts",W="transactionCostsType",X="savingPhase",Z="age",$="taxFreeAmount",tt="monthlyPayout",et="lifeExpectation",at=(V={},Object(m.a)(V,q,"Starting Capital"),Object(m.a)(V,G,"Monthly Investment"),Object(m.a)(V,Q,"Transaction Costs"),Object(m.a)(V,W,"Fixes Amount ?"),Object(m.a)(V,X,"Saving Phase"),Object(m.a)(V,Z,"Your Age"),Object(m.a)(V,$,"Tax Free Amount"),Object(m.a)(V,tt,"Monthly Payout"),Object(m.a)(V,et,"Life Expectation"),V);function nt(t,e){var a=parseInt(t.target.value);return isNaN(a)?0:a}function rt(t,e){var a=parseFloat(t.target.value);return isNaN(a)?0:a}function it(t,e){return!e.props.value}function st(){return ot.apply(this,arguments)}function ot(){return(ot=Object(p.a)(c.a.mark((function t(){var e;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return I.configure("demo"),e=I.getInstance(),t.next=4,e.loadAndCacheHistoricalETFData("IBM");case 4:console.log("Finished loading the historic data.");case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var ct=function(t){Object(v.a)(a,t);var e=Object(f.a)(a);function a(t){var n,i;return Object(l.a)(this,a),(i=e.call(this,t)).state=(n={},Object(m.a)(n,q,{value:1e4,type:"text",transformFunction:nt}),Object(m.a)(n,G,{value:100,type:"text",transformFunction:nt}),Object(m.a)(n,tt,{value:1e3,type:"text",transformFunction:nt}),Object(m.a)(n,Q,{value:.005,type:"text",transformFunction:rt}),Object(m.a)(n,W,{value:!1,type:"checkbox",transformFunction:it}),Object(m.a)(n,X,{value:40,type:"text",transformFunction:nt}),Object(m.a)(n,Z,{value:30,type:"text",transformFunction:nt}),Object(m.a)(n,$,{value:801,type:"text",transformFunction:nt}),Object(m.a)(n,et,{value:80,type:"text",transformFunction:nt}),n),i.ref=r.a.createRef(),i.handleChange=i.handleChange.bind(Object(h.a)(i)),i}return Object(d.a)(a,[{key:"handleChange",value:function(t,e){var a=Object(u.a)({},this.state[e]);a.value=t,this.setState(Object(m.a)({},e,a)),console.log("State ".concat(e," changed value to ").concat(t,"."))}},{key:"getVisualizationModel",value:function(){return new J(this.state.startingCapital.value,this.state.monthlyInvestment.value,this.state.monthlyPayout.value,this.state.savingPhase.value,{IBM:1},{taxFreeAmount:this.state.taxFreeAmount.value,costConfig:(t=this.state,t.transactionCostsType.value?{percentageCosts:0,fixedCosts:t.transactionCosts.value}:{percentageCosts:t.transactionCosts.value,fixedCosts:0})},this.state.age.value,this.state.lifeExpectation.value);var t}},{key:"componentDidMount",value:function(){var t=Object(p.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,st();case 2:(new U).render(this.getVisualizationModel().investmentSteps,this.ref.current);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){(new U).render(this.getVisualizationModel().investmentSteps,this.ref.current)}},{key:"render",value:function(){var t=this;return Object(K.jsxs)(r.a.Fragment,{children:[Object(K.jsx)("form",{children:Object.keys(this.state).map((function(e){return Object(K.jsx)(ut,{label:at[e],value:t.state[e].value,type:t.state[e].type,onValueChange:t.handleChange,stateIdentifier:e,transformFunction:t.state[e].transformFunction},e)}))}),Object(K.jsx)("div",{ref:this.ref})]})}}]),a}(r.a.Component),ut=function(t){Object(v.a)(a,t);var e=Object(f.a)(a);function a(t){var n;return Object(l.a)(this,a),(n=e.call(this,t)).handleChange=n.handleChange.bind(Object(h.a)(n)),n}return Object(d.a)(a,[{key:"handleChange",value:function(t){this.props.onValueChange(this.props.transformFunction(t,this),this.props.stateIdentifier)}},{key:"render",value:function(){return Object(K.jsxs)("label",{children:[this.props.label,Object(K.jsx)("input",{type:this.props.type,value:this.props.value,onChange:this.handleChange})]})}}]),a}(r.a.Component),lt=ct;var dt=function(){return Object(K.jsx)("div",{className:"Input",children:Object(K.jsx)(lt,{})})},ht=function(t){t&&t instanceof Function&&a.e(3).then(a.bind(null,164)).then((function(e){var a=e.getCLS,n=e.getFID,r=e.getFCP,i=e.getLCP,s=e.getTTFB;a(t),n(t),r(t),i(t),s(t)}))};s.a.render(Object(K.jsx)(r.a.StrictMode,{children:Object(K.jsx)(dt,{})}),document.getElementById("root")),ht()}},[[163,1,2]]]);
//# sourceMappingURL=main.f337e43d.chunk.js.map