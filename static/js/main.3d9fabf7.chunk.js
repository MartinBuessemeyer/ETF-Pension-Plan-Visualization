(this["webpackJsonpetf-vis"]=this["webpackJsonpetf-vis"]||[]).push([[0],{157:function(t,e,a){},158:function(t,e,a){},161:function(t,e,a){"use strict";a.r(e);var n=a(5),i=a.n(n),s=a(45),r=a.n(s),o=(a(157),a(158),a(6)),c=a(7),l=a(12),u=a(24),h=a(27),d=a(0),v=a(2),f=a(3),p=a.n(f),m=a(13),g=a(48),b=a.n(g),y=a(4),j=36e5,O=12;function x(t){return[.01*t,.99*t]}function C(t,e){return I.apply(this,arguments)}function I(){return(I=Object(m.a)(p.a.mark((function t(e,a){var n;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y.c("https://www.alphavantage.co/query?function=TIME_SERIES_MONTHLY_ADJUSTED&symbol=".concat(e,"&apikey=").concat(a,"&datatype=csv"),(function(t){return{timestamp:new Date(t.timestamp.toString()),dividend:parseFloat(t["dividend amount"]),course:parseFloat(t["adjusted close"])}}));case 2:return(n=t.sent).sort((function(t,e){return t.timestamp-e.timestamp})),t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function D(t){return t.map((function(t){return[F(t.timestamp),t.course]}))}function F(t){return Math.floor(t.getTime()/j)}var M=function(){function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7;Object(o.a)(this,t),this.historicalData={},this.predictors={},this.backCastTimeFactor=a,this.apiKey=e;var i=new Date(0);i.setMonth(n),this.backCastTimestampConstant=F(i)}return Object(c.a)(t,[{key:"_loadHistoricalDataIfNotPresent",value:function(){var t=Object(m.a)(p.a.mark((function t(e){var a,n,i,s,r;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e in this.historicalData)){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,C(e);case 4:a=t.sent,n=D(a),i=n[0][0],s=n[n.length-1][0],r=s+(s-i)/this.backCastTimeFactor,this.historicalData[e]={history:a,forecastArray:n,maxTimestampBeforePredictorRepetition:r};case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"_createPredictorIfNotPresent",value:function(t,e){if(t in this.predictors||(this.predictors[t]={}),!(e in this.predictors[t])){var a=this.historicalData[t].forecastArray,n=a[a.length-1][0]-Math.abs(a[a.length-1][0]-e)*this.backCastTimeFactor-this.backCastTimestampConstant,i=a.filter((function(t){return t[0]>=n}));this.predictors[t][e]=b.a.linear(i)}}},{key:"_dateToPredictorTimestampAndDateTimestamp",value:function(t){var e=F(t);return[e>this.maxTimestampBeforePredictorRepetition?this.maxTimestampBeforePredictorRepetition:e,e]}},{key:"predict",value:function(){var t=Object(m.a)(p.a.mark((function t(e,a){var n,i,s,r;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._loadHistoricalDataIfNotPresent(e,this.apiKey);case 2:return n=this._dateToPredictorTimestampAndDateTimestamp(a),i=Object(v.a)(n,2),s=i[0],r=i[1],this._createPredictorIfNotPresent(e,s),t.abrupt("return",this.predictors[e][s].predict(r)[1]);case 5:case"end":return t.stop()}}),t,this)})));return function(e,a){return t.apply(this,arguments)}}()}]),t}(),k=.025;function w(t){return[.75*t,.25*t]}var T=function(){function t(e,a,n,i,s,r,c){Object(o.a)(this,t),this.lastYearModelValues=c,this.date=e,this.newInvestmentAmount=n,this.nextDate=a,this.etfIdentifierToRatio=i,this.costFunction=s,this.dividendFunction=r;var l=x(this.lastYearModelValues.investedMoney+this.newInvestmentAmount),u=Object(v.a)(l,2),h=(u[0],u[1]);this.values={costs:c.costs,taxes:c.taxes,inflation:c.inflation,etfs:{},investedMoney:h},this.calculate()}return Object(c.a)(t,[{key:"calculate",value:function(){var t=new Date(this.nextDate-this.date),e=t.getFullYear()-new Date(0).getFullYear()+t.getMonth()/O;for(var a in this.lastYearModelValues.etfs){var n=this.etfIdentifierToRatio[a]*this.newInvestmentAmount;this.values.etfs[a]={},this.calculateNextEtfValueAndCosts(a,n,e)}}},{key:"calculateNewInvestmentOfETFAndCosts",value:function(t,e){for(var a=Math.round(e*O),n=t/a,i=this.costFunction(n),s=Object(v.a)(i,2),r=s[0],o=s[1]*a,c=0,l=a;l>0;l--)c+=k*(l/O)*r+r;return[c,o]}},{key:"accumulateDividendAndTaxes",value:function(t){for(var e=this.nextDate.getFullYear()-this.date.getFullYear(),a=0,n=0,i=0;i<e;i++){var s=Math.max(0,e-1-i),r=w(this.dividendFunction(t,this.date.getFullYear()+i)),o=Object(v.a)(r,2),c=o[0],l=o[1];n+=c+c*s*k,a+=l}return[n,a]}},{key:"calculateNextEtfValueAndCosts",value:function(t,e,a){var n=this.lastYearModelValues.etfs[t],i=k*a*n.startCapital+n.startCapital,s=k*a*n.monthlyInvestment,r=k*a*n.dividend,o=this.calculateNewInvestmentOfETFAndCosts(e,a),c=Object(v.a)(o,2),l=c[0],u=c[1],h=this.accumulateDividendAndTaxes(t),d=Object(v.a)(h,2),f=d[0],p=d[1],m=x(i),g=Object(v.a)(m,2),b=g[0],y=g[1];this.values.inflation+=b,this.values.etfs[t].startCapital=y;var j=x(n.monthlyInvestment+s+l),O=Object(v.a)(j,2),C=O[0],I=O[1];this.values.inflation+=C,this.values.etfs[t].monthlyInvestment=I;var D=x(n.dividend+f+r),F=Object(v.a)(D,2),M=F[0],w=F[1];this.values.inflation+=M,this.values.etfs[t].dividend=w,this.values.costs+=u,this.values.taxes+=p}},{key:"getD3Representation",value:function(){if(null!=this.d3Representation)return this.d3Representation;var t=this.values.taxes+this.values.costs+this.values.inflation,e=[{height:this.values.inflation,yStart:0,yEnd:0-this.values.inflation,class:"inflation"},{height:this.values.taxes,yStart:-this.values.inflation,yEnd:-this.values.inflation-this.values.taxes,class:"taxes"},{height:this.values.costs,yStart:-this.values.inflation-this.values.taxes,yEnd:-this.values.taxes-this.values.costs-this.values.inflation,class:"costs"}],a=0;for(var n in this.values.etfs){var i=this.values.etfs[n];e.push({height:i.startCapital,yStart:a+i.startCapital,yEnd:a,class:"".concat(n,"_start_capital")}),a+=i.startCapital,e.push({height:i.dividend,yStart:a+i.dividend,yEnd:a,class:"".concat(n,"_dividend")}),a+=i.dividend,e.push({height:i.monthlyInvestment,yStart:a+i.monthlyInvestment,yEnd:a,class:"".concat(n,"_monthly_investment")}),a+=i.monthlyInvestment}return this.d3Representation={extent:[-t,a],bars:e,investedMoney:{money:this.values.investedMoney,date:this.nextDate}},this.d3Representation}}],[{key:"getInitialModelValues",value:function(t,e,a){for(var n=a(t),i=Object(v.a)(n,2),s=i[0],r={costs:i[1],taxes:0,inflation:0,investedMoney:t,etfs:{}},o=0,c=Object.entries(e);o<c.length;o++){var l=Object(v.a)(c[o],2),u=l[0],h=l[1];r.etfs[u]={startCapital:h*s,dividend:0,monthlyInvestment:0}}return r}}]),t}();function P(t,e){var a=t.getMonth()+e,n=a%O,i=t.getFullYear()+Math.floor(a/O);return new Date(i,n)}var S,R=function(){function t(e,a,n,i,s,r){var c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:12;Object(o.a)(this,t),this.startCapital=e,this.investmentPerPeriod=a*c,this.savingPhaseLength=n,this.etfIdentifierToRatio=i,this.costFunction=s,this.age=r,this.intervalLengthInMonths=c,this._calculateTimestampsForVisualization(),this._calculateAllYearModels()}return Object(c.a)(t,[{key:"_calculateTimestampsForVisualization",value:function(){for(var t=function(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:80)-t,n=new Date(0);n.setFullYear((new Date).getFullYear());var i=new Date(0);return i.setFullYear((new Date).getFullYear()+a+e),[n,i]}(this.age),e=Object(v.a)(t,2),a=e[0],n=e[1],i=[],s=a;s<=n;)i.push(s),s=P(s,this.intervalLengthInMonths);this.dates=i,this.nextFutureDate=s}},{key:"_calculateAllYearModels",value:function(){for(var t=this,e=function(e){return.05*t.startCapital},a=T.getInitialModelValues(this.startCapital,this.etfIdentifierToRatio,this.costFunction),n=[new T(this.dates[0],this.dates[1],this.investmentPerPeriod,this.etfIdentifierToRatio,this.costFunction,e,a)],i=0;i<this.dates.length-1;i++){var s=n[n.length-1].values;n.push(new T(this.dates[i],this.dates[i+1],this.investmentPerPeriod,this.etfIdentifierToRatio,this.costFunction,e,s))}this.dates.length>1&&(n.push(new T(this.dates[this.dates.length-1],this.nextFutureDate,this.investmentPerPeriod,this.etfIdentifierToRatio,this.costFunction,e,n[n.length-1].values)),this.yearModels=n)}},{key:"renderVisualization",value:function(t){for(var e=1e3,a=y.i(t).append("svg").attr("id","firstSVG").attr("height","100%").attr("width","100%").attr("viewBox","0 0 ".concat(1300," ").concat(480)).append("g").attr("transform","translate(".concat([150,40],")")),n=this.yearModels.map((function(t){return t.getD3Representation()})),i=n.map((function(t){return t.extent})),s=y.f(i.map((function(t){return t[0]}))),r=y.e(i.map((function(t){return t[1]}))),o=y.g().domain([s,r]).range([400,0]),c=y.h().domain([this.dates[0],this.nextFutureDate]).range([0,e]),l=e/this.dates.length*.9,u=0;u<this.yearModels.length;u++){var h=this.yearModels[u],d=h.date,v=d.toDateString().split(" ").join("_"),f=h.getD3Representation().bars;a.selectAll("rect.".concat(v)).append("g").attr("class",v).data(f).enter().append("rect").attr("x",c(d)).attr("y",(function(t){return o(t.yStart)})).attr("width",l).attr("height",(function(t){return o(t.yEnd)-o(t.yStart)})).attr("class",(function(t){return t.class}))}a.append("g").style("font-size","20px").call(y.b(o).tickFormat((function(t){return"".concat(t.toLocaleString()," EUR")}))),a.append("g").style("font-size","20px").attr("transform","translate(0, ".concat(400,")")).call(y.a(c)),a.append("g").append("line").attr("x1",c(this.dates[0])).attr("y1",o(0)).attr("x2",c(this.nextFutureDate)).attr("y2",o(0)).attr("stroke-width",3).attr("stroke","black");var p=n.map((function(t){return t.investedMoney}));p.unshift({date:this.dates[0],money:this.startCapital}),a.append("path").datum(p).attr("fill","none").attr("id","investedMoney").attr("stroke-width",3).attr("d",y.d().x((function(t){return c(t.date)})).y((function(t){return o(t.money)})))}},{key:"updateVisualization",value:function(){}}]),t}(),_=a(1),A="startingCapital",Y="monthlyInvestment",E="transactionCosts",V="savingPhase",N="payoutPhase",B="predict",z="predictOut",L=(S={},Object(d.a)(S,A,"Starting Capital"),Object(d.a)(S,Y,"Monthly Investment"),Object(d.a)(S,E,"Transaction Costs"),Object(d.a)(S,V,"Saving Phase"),Object(d.a)(S,N,"Payout Phase"),Object(d.a)(S,"age","Your Age"),S),H=function(t){Object(u.a)(a,t);var e=Object(h.a)(a);function a(t){var n,s;Object(o.a)(this,a),(s=e.call(this,t)).state=(n={},Object(d.a)(n,A,1e4),Object(d.a)(n,Y,100),Object(d.a)(n,E,5),Object(d.a)(n,V,40),Object(d.a)(n,N,20),Object(d.a)(n,"age",30),Object(d.a)(n,B,new Date("2021-06-01").toISOString().slice(0,10)),Object(d.a)(n,z,0),n),s.forecastModel=new M("demo"),s.handleChange=s.handleChange.bind(Object(l.a)(s));return s.vis=new R(1e4,100,40,{IBM:1},(function(t){return[t-5,5]}),30),console.log(s.vis),s.ref=i.a.createRef(),s}return Object(c.a)(a,[{key:"handleChange",value:function(t,e){this.setState(Object(d.a)({},e,t)),console.log("State ".concat(e," changed value to ").concat(t,"."))}},{key:"componentDidMount",value:function(){this.vis.renderVisualization(this.ref.current)}},{key:"render",value:function(){var t=this;return Object(_.jsxs)(i.a.Fragment,{children:[Object(_.jsx)("form",{children:Object.keys(this.state).map((function(e){return Object(_.jsx)(J,{label:L[e],value:t.state[e],onValueChange:t.handleChange,stateIdentifier:e},e)}))}),Object(_.jsxs)("label",{children:["Predict Date:",Object(_.jsx)("input",{type:"text",value:this.state.predict,onChange:function(e){var a=new Date(e.target.value);t.handleChange(e.target.value,B),null==a||isNaN(a.getTime())||t.forecastModel.predict("IBM",a).then((function(e){return t.handleChange(e,z)}))}},B)]}),Object(_.jsxs)("label",{children:["Prediction:",Object(_.jsx)("p",{children:this.state.predictOut},z)]}),Object(_.jsx)("div",{ref:this.ref})]})}}]),a}(i.a.Component),J=function(t){Object(u.a)(a,t);var e=Object(h.a)(a);function a(t){var n;return Object(o.a)(this,a),(n=e.call(this,t)).state={value:""},n.handleChange=n.handleChange.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"handleChange",value:function(t){this.props.onValueChange(t.target.value,this.props.stateIdentifier)}},{key:"render",value:function(){return Object(_.jsxs)("label",{children:[this.props.label,Object(_.jsx)("input",{type:"text",value:this.props.value,onChange:this.handleChange})]})}}]),a}(i.a.Component),K=H;var U=function(){return Object(_.jsx)("div",{className:"Input",children:Object(_.jsx)(K,{})})},q=function(t){t&&t instanceof Function&&a.e(3).then(a.bind(null,162)).then((function(e){var a=e.getCLS,n=e.getFID,i=e.getFCP,s=e.getLCP,r=e.getTTFB;a(t),n(t),i(t),s(t),r(t)}))};r.a.render(Object(_.jsx)(i.a.StrictMode,{children:Object(_.jsx)(U,{})}),document.getElementById("root")),q()}},[[161,1,2]]]);
//# sourceMappingURL=main.3d9fabf7.chunk.js.map