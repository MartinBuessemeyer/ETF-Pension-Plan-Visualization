(this["webpackJsonpetf-vis"]=this["webpackJsonpetf-vis"]||[]).push([[0],{159:function(t,e,a){},160:function(t,e,a){},163:function(t,e,a){"use strict";a.r(e);var n=a(8),i=a.n(n),r=a(48),s=a.n(r),o=(a(159),a(160),a(3)),c=a.n(o),u=a(11),l=a(6),d=a(7),h=a(14),f=a(26),v=a(30),p=a(0),m=a(5),g=a(29),y=a.n(g),b=a(1),x=864e5,D=12;function C(t){return 0===t.getMonth()}function j(t,e){return t.getFullYear()<e.getFullYear()}function O(t){return Math.round(100*t)/100}function T(t,e){return F.apply(this,arguments)}function F(){return(F=Object(u.a)(c.a.mark((function t(e,a){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.c("https://www.alphavantage.co/query?function=TIME_SERIES_MONTHLY_ADJUSTED&symbol=".concat(e,"&apikey=").concat(a,"&datatype=csv"),(function(t){return{date:new Date(t.timestamp.toString()),dividend:parseFloat(t["dividend amount"]),course:parseFloat(t["adjusted close"])}}));case 2:return(n=t.sent).sort((function(t,e){return t.date-e.date})),t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function P(t){return t.map((function(t){return[k(t.date),t.course]}))}function M(t){var e=t[0].date.getFullYear(),a=[[e,0]];return t.forEach((function(t){t.date.getFullYear()===e?a[a.length-1][1]+=t.dividend:(e=t.date.getFullYear(),a.push([e,t.dividend]))})),a.sort((function(t,e){return t[0]-e[0]})),a}function k(t){return Math.floor(t.getTime()/x)}var I=function(){function t(){Object(l.a)(this,t),this.historicalData={},this.coursePredictors={},this.dividendPredictors={}}return Object(d.a)(t,[{key:"loadAndCacheHistoricalETFData",value:function(){var e=Object(u.a)(c.a.mark((function e(a){var n,i,r,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a in this.historicalData)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,T(a);case 4:n=e.sent,i=P(n),r=t._calculateMaxTimestampBeforePredictorRepetition(i),s=M(n),o=t._calculateMaxTimestampBeforePredictorRepetition(s),this.historicalData[a]={history:n,courseForecastArray:i,dividendForecastArray:s},this.coursePredictors[a]={maxTimestampBeforeCoursePredictorRepetition:r},this.dividendPredictors[a]={maxYearBeforeDividendPredictorRepetition:o};case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCoursePredictorIfNotPresent",value:function(e,a){if(!(a in this.coursePredictors[e])){var n=this.historicalData[e].courseForecastArray,i=n[n.length-1][0]-Math.abs(n[n.length-1][0]-a)*t.backCastTimeFactor-t.backCastTimestampConstant,r=n.filter((function(t){return t[0]>=i}));this.coursePredictors[e][a]=y.a.linear(r,{order:2,precision:20})}}},{key:"_courseDateToPredictorTimestampAndDateTimestamp",value:function(t,e){var a=k(t);return[a>this.coursePredictors[e].maxTimestampBeforeCoursePredictorRepetition?this.coursePredictors[e].maxTimestampBeforeCoursePredictorRepetition:a,a]}},{key:"_createDividendPredictorIfNotPresent",value:function(e,a){if(!(a in this.dividendPredictors[e])){var n=this.historicalData[e].dividendForecastArray,i=n[n.length-1][0]-Math.abs(n[n.length-1][0]-a)*t.backCastTimeFactor-t.backCastTimestampConstant,r=n.filter((function(t){return t[0]>=i}));this.dividendPredictors[e][a]=y.a.linear(r,{order:2,precision:20})}}},{key:"_dividendYearToPredictorYear",value:function(t,e){return this.dividendPredictors[t].maxYearBeforeDividendPredictorRepetition<e?this.dividendPredictors[t].maxYearBeforeDividendPredictorRepetition:e}},{key:"predictCourse",value:function(t,e){if(!(t in this.coursePredictors))throw"First call loadHistoricalDataIfNotPresent() before predicting: ".concat(t);var a=this._courseDateToPredictorTimestampAndDateTimestamp(e,t),n=Object(m.a)(a,2),i=n[0],r=n[1];return this._createCoursePredictorIfNotPresent(t,i),this.coursePredictors[t][i].predict(r)[1]}},{key:"predictDividend",value:function(t,e){if(!(t in this.dividendPredictors))throw"First call loadHistoricalDataIfNotPresent() before predicting: ".concat(t);var a=this._dividendYearToPredictorYear(t,e);return this._createDividendPredictorIfNotPresent(t,a),Math.max(0,this.dividendPredictors[t][a].predict(e)[1])}}],[{key:"configure",value:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7;t.apiKey=e,t.backCastTimeFactor=a;var i=new Date(0);if(i.setMonth(n),t.backCastTimestampConstant=k(i),null!=t.instance){var r=t.getInstance();for(var s in r.coursePredictors)r.coursePredictors[s]={maxTimestampBeforeCoursePredictorRepetition:t._calculateMaxTimestampBeforePredictorRepetition(r.historicalData[s].courseForecastArray)};for(var o in r.dividendPredictors)r.dividendPredictors[o]={maxYearBeforeDividendPredictorRepetition:t._calculateMaxTimestampBeforePredictorRepetition(r.historicalData[o].dividendForecastArray)}}}},{key:"getInstance",value:function(){return null==t.instance&&(t.instance=new t),t.instance}},{key:"_calculateMaxTimestampBeforePredictorRepetition",value:function(e){var a=e[0][0],n=e[e.length-1][0];return n+(n-a)/t.backCastTimeFactor}}]),t}();I.instance=null,I.apiKey=null,I.backCastTimeConstant=null,I.backCastTimeFactor=null;var w=I,A=a(2),Y=.26375;function S(t,e,a,n){var i=I.getInstance(),r=i.predictCourse(n,e);return O(t*(i.predictCourse(n,a)/r)-t)}function R(t,e){var a=t*e.percentageCosts+e.fixedCosts;return[t-a,a]}function _(t,e,a,n){if(!j(a,n))return[0,e];var i=function(t,e){return[Math.max(0,t-e),Math.max(0,e-t)]}(t,e),r=Object(m.a)(i,2),s=r[0],o=r[1];return[.7*s*Y,o]}var B=0,V=1,E=function(){function t(e,a,n,i,r,s,o,c){Object(l.a)(this,t),this.initialDate=e,this.lastYearModelValues=o,this.startDate=a,this.newInvestmentAmount=i,this.endDate=n,this.etfIdentifierToRatio=r,this.costConfiguration=s,this.costs=o.costs,this.taxes=o.taxes,this.etfs={},this.yearBeginningCapital=C(this.startDate)?o.totalAmount:o.yearBeginningCapital,this.totalAmount=0,this.investedMoney=o.investedMoney+i,this.leftoverTaxFreeAmount=C(this.startDate)?c:o.leftoverTaxFreeAmount,this.investmentStepsOfThisYear=C(this.startDate)?[]:o.investmentStepsOfThisYear,this.alreadyPaidTaxesForAmount=0,this.calculate()}return Object(d.a)(t,[{key:"calculate",value:function(){var t=0;for(var e in this.lastYearModelValues.etfs){var a=this.etfIdentifierToRatio[e]*this.newInvestmentAmount;this.etfs[e]={},t+=this.calculateNextEtfValueAndCosts(e,a)}var n=this.totalAmount-this.yearBeginningCapital-t,i=function(t,e,a){if(e<=0)return 0;var n,i=a,r=Object(A.a)(t);try{for(r.s();!(n=r.n()).done;){var s=n.value,o=s[B],c=D-o.getMonth();for(var u in s[V])i+=s[V][u]*c/D}}catch(l){r.e(l)}finally{r.f()}return Math.min(.7*i*.015,e)}(this.investmentStepsOfThisYear,n,this.yearBeginningCapital),r=_(i,this.leftoverTaxFreeAmount,this.startDate,this.endDate),s=Object(m.a)(r,2),o=s[0],c=s[1];this.alreadyPaidTaxesForAmount=i,this.taxes+=o,this.leftoverTaxFreeAmount=c,this.inflation=function(t,e,a){var n=a.getFullYear()-e.getFullYear()+(a.getMonth()-e.getMonth())/D;return t-t*Math.pow(.99,n)}(this.totalAmount,this.initialDate,this.endDate)}},{key:"calculateNextEtfValueAndCosts",value:function(t,e){var a=this.lastYearModelValues.etfs[t],n=S(a.capital,this.startDate,this.endDate,t),i=S(a.dividend,this.startDate,this.endDate,t),r=this._calculateNewInvestmentOfETFAndCosts(e,t),s=Object(m.a)(r,3),o=s[0],c=s[1],u=s[2],l=function(t,e,a){return j(e,a)?O(I.getInstance().predictDividend(t,e.getFullYear())):0}(t,this.startDate,this.endDate),d=n+i+c+l,h=a.capital+d+o;return this.etfs[t].capital=h,this.etfs[t].dividend=a.dividend+l+i,this.totalAmount+=h,this.costs+=u,o}},{key:"_calculateNewInvestmentOfETFAndCosts",value:function(t,e){for(var a=(this.endDate.getFullYear()-this.startDate.getFullYear())*D+this.endDate.getMonth()-this.startDate.getMonth(),n=R(t/a,this.costConfiguration),i=Object(m.a)(n,2),r=i[0],s=i[1]*a,o=r*a,c=0,u=a;u>0;u--){var l=new Date(this.startDate);l.setMonth(l.getMonth()+u),c+=S(r,l,this.endDate,e),this._addInvestmentStep(r,e,l)}return[o,c,s]}},{key:"_addInvestmentStep",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null==a&&(a=this.startDate);var n=this.investmentStepsOfThisYear.findIndex((function(t){return t[0]==a}));n<0&&(n=this.investmentStepsOfThisYear.length,this.investmentStepsOfThisYear.push([a,{}])),e in this.investmentStepsOfThisYear[n]?this.investmentStepsOfThisYear[n][V][e]+=t:this.investmentStepsOfThisYear[n][V][e]=t}}],[{key:"getInitialModelValues",value:function(t,e,a,n,i){for(var r=R(t,a),s=Object(m.a)(r,2),o=s[0],c={costs:s[1],taxes:0,inflation:0,investedMoney:t,etfs:{},yearBeginningCapital:o,totalAmount:o,leftoverTaxFreeAmount:n,startDate:i,endDate:i,investmentSteps:[[i,{}]]},u=0,l=Object.entries(e);u<l.length;u++){var d=Object(m.a)(l[u],2),h=d[0],f=d[1];c.etfs[h]={capital:f*o,dividend:0},c.investmentSteps[0][B][h]=f*o}return c}}]),t}();function N(t,e){var a=t.getMonth()+e,n=a%D,i=t.getFullYear()+Math.floor(a/D);return new Date(i,n)}var z,L=function(){function t(e,a,n,i,r,s,o){var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:D;if(Object(l.a)(this,t),!Number.isInteger(c/D))throw"currently only month lengths that are a factor of ".concat(D," are allowed.");this.taxFreeAmount=o,this.startCapital=e,this.investmentPerPeriod=a*c,this.savingPhaseLength=n,this.etfIdentifierToRatio=i,this.costConfiguration=r,this.age=s,this.intervalLengthInMonths=c,this._calculateTimestampsForVisualization(),this._calculateAllYearModels()}return Object(d.a)(t,[{key:"_calculateTimestampsForVisualization",value:function(){for(var t=function(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:80)-t,n=new Date(0);n.setFullYear((new Date).getFullYear());var i=new Date(0);return i.setFullYear((new Date).getFullYear()+a+e),[n,i]}(this.age),e=Object(m.a)(t,2),a=e[0],n=e[1],i=[],r=a;r<=n;)i.push(r),r=N(r,this.intervalLengthInMonths);this.dates=i,this.nextFutureDate=r}},{key:"_calculateAllYearModels",value:function(){for(var t=[E.getInitialModelValues(this.startCapital,this.etfIdentifierToRatio,this.costConfiguration,this.taxFreeAmount,this.dates[0])],e=0;e<this.dates.length-1;e++){var a=t[t.length-1];t.push(new E(this.dates[0],this.dates[e],this.dates[e+1],this.investmentPerPeriod,this.etfIdentifierToRatio,this.costConfiguration,a,this.taxFreeAmount))}this.dates.length>1&&(t.push(new E(this.dates[0],this.dates[this.dates.length-1],this.nextFutureDate,this.investmentPerPeriod,this.etfIdentifierToRatio,this.costConfiguration,t[t.length-1],this.taxFreeAmount)),this.yearModels=t)}},{key:"renderVisualization",value:function(t){for(var e=1e3,a=b.i(t).append("svg").attr("id","firstSVG").attr("height","100%").attr("width","100%").attr("viewBox","0 0 ".concat(1300," ").concat(480)).append("g").attr("transform","translate(".concat([150,40],")")),n=this.yearModels.map((function(t){return t.getD3Representation()})),i=n.map((function(t){return t.extent})),r=b.f(i.map((function(t){return t[0]}))),s=b.e(i.map((function(t){return t[1]}))),o=b.g().domain([r,s]).range([400,0]),c=b.h().domain([this.dates[0],this.nextFutureDate]).range([0,e]),u=e/this.dates.length*.9,l=0;l<this.yearModels.length;l++){var d=this.yearModels[l],h=d.date,f=h.toDateString().split(" ").join("_"),v=d.getD3Representation().bars;a.selectAll("rect.".concat(f)).append("g").attr("class",f).data(v).enter().append("rect").attr("x",c(h)).attr("y",(function(t){return o(t.yStart)})).attr("width",u).attr("height",(function(t){return o(t.yEnd)-o(t.yStart)})).attr("class",(function(t){return t.class}))}a.append("g").style("font-size","20px").call(b.b(o).tickFormat((function(t){return"".concat(t.toLocaleString()," EUR")}))),a.append("g").style("font-size","20px").attr("transform","translate(0, ".concat(400,")")).call(b.a(c)),a.append("g").append("line").attr("x1",c(this.dates[0])).attr("y1",o(0)).attr("x2",c(this.nextFutureDate)).attr("y2",o(0)).attr("stroke-width",3).attr("stroke","black");var p=n.map((function(t){return t.investedMoney}));p.unshift({date:this.dates[0],money:this.startCapital}),a.append("path").datum(p).attr("fill","none").attr("id","investedMoney").attr("stroke-width",3).attr("d",b.d().x((function(t){return c(t.date)})).y((function(t){return o(t.money)})))}},{key:"updateVisualization",value:function(){}}]),t}(),H=function(){function t(){Object(l.a)(this,t)}return Object(d.a)(t,[{key:"render",value:function(t,e){e.innerHTML="";var a=b.i(e).append("svg").attr("id","firstSVG").attr("height","100%").attr("width","100%").attr("viewBox","0 0 ".concat(1300," ").concat(480)).append("g").attr("transform","translate(".concat([150,40],")")),n={costs:0,taxes:1,inflation:2},i=3,r="capital",s="dividend";for(var o in t.etfIdentifierToRatio)n[o+s]=i++,n[o+r]=i++;for(var c=[],u=0;u<i;u++)c.push([]);var l,d=Object(A.a)(t.yearModels);try{for(d.s();!(l=d.n()).done;){var h=l.value;c[n.costs].push({value:-h.costs,date:h.endDate}),c[n.taxes].push({value:-h.taxes-h.costs,date:h.endDate}),c[n.inflation].push({value:-h.inflation-h.taxes-h.costs,date:h.endDate});var f=0;for(var v in t.etfIdentifierToRatio)c[n[v+r]].push({value:h.etfs[v].capital+f,date:h.endDate}),c[n[v+s]].push({value:h.etfs[v].capital-h.etfs[v].dividend+f,date:h.endDate}),f+=h.etfs[v].capital}}catch(C){d.e(C)}finally{d.f()}for(var p in c[n.inflation].cssClass="inflation",c[n.taxes].cssClass="taxes",c[n.costs].cssClass="costs",t.etfIdentifierToRatio)c[n[p+s]].cssClass="".concat(p,"_dividend"),c[n[p+r]].cssClass="".concat(p,"_total_amount");var m=b.f(c[n.inflation].map((function(t){return t.value}))),g=b.e(c[c.length-1].map((function(t){return t.value}))),y=b.g().domain([m,g]).range([400,0]),x=b.h().domain([t.dates[0],t.nextFutureDate]).range([0,1e3]);a.append("g").style("font-size","20px").call(b.b(y).tickFormat((function(t){return"".concat(t.toLocaleString()," EUR")}))),a.append("g").style("font-size","20px").attr("transform","translate(0, ".concat(400,")")).call(b.a(x)),a.append("g").append("line").attr("x1",x(t.dates[0])).attr("y1",y(0)).attr("x2",x(t.nextFutureDate)).attr("y2",y(0)).attr("stroke-width",3).attr("stroke","black");for(var D=0;D<c.length;D++)a.append("path").datum(c[D]).attr("fill","none").attr("class",(function(t){return t.cssClass})).attr("stroke-width",3).attr("d",b.d().x((function(t){return x(t.date)})).y((function(t){return y(t.value)})))}}]),t}(),U=a(4),J="startingCapital",G="monthlyInvestment",K="transactionCosts",q="transactionCostsType",Q="savingPhase",W="payoutPhase",X="age",Z="taxFreeAmount",$=(z={},Object(p.a)(z,J,"Starting Capital"),Object(p.a)(z,G,"Monthly Investment"),Object(p.a)(z,K,"Transaction Costs"),Object(p.a)(z,q,"Fixes Amount ?"),Object(p.a)(z,Q,"Saving Phase"),Object(p.a)(z,W,"Payout Phase"),Object(p.a)(z,X,"Your Age"),Object(p.a)(z,Z,"Tax Free Amount"),z),tt=function(t){Object(f.a)(a,t);var e=Object(v.a)(a);function a(t){var n,r;return Object(l.a)(this,a),(r=e.call(this,t)).state=(n={},Object(p.a)(n,J,{value:1e4,type:"text"}),Object(p.a)(n,G,{value:100,type:"text"}),Object(p.a)(n,K,{value:.005,type:"text"}),Object(p.a)(n,q,{value:!1,type:"checkbox"}),Object(p.a)(n,Q,{value:40,type:"text"}),Object(p.a)(n,W,{value:20,type:"text"}),Object(p.a)(n,X,{value:30,type:"text"}),Object(p.a)(n,Z,{value:801,type:"text"}),n),r.ref=i.a.createRef(),r.handleChange=r.handleChange.bind(Object(h.a)(r)),r}return Object(d.a)(a,[{key:"handleChange",value:function(t,e){this.setState(Object(p.a)({},e,{value:t,type:this.state[e].type})),console.log("State ".concat(e," changed value to ").concat(t,"."))}},{key:"getVisualizationModel",value:function(){return new L(this.state.startingCapital.value,this.state.monthlyInvestment.value,this.state.savingPhase.value,{IBM:1},{percentageCosts:0,fixedCosts:5},this.state.age.value,this.state.taxFreeAmount.value)}},{key:"componentDidMount",value:function(){var t=Object(u.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return w.configure("demo"),this.forecastModel=w.getInstance(),t.next=4,this.forecastModel.loadAndCacheHistoricalETFData("IBM");case 4:(new H).render(this.getVisualizationModel(),this.ref.current);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){(new H).render(this.getVisualizationModel(),this.ref.current)}},{key:"render",value:function(){var t=this;return Object(U.jsxs)(i.a.Fragment,{children:[Object(U.jsx)("form",{children:Object.keys(this.state).map((function(e){return Object(U.jsx)(et,{label:$[e],value:t.state[e].value,type:t.state[e].type,onValueChange:t.handleChange,stateIdentifier:e},e)}))}),Object(U.jsx)("div",{ref:this.ref})]})}}]),a}(i.a.Component),et=function(t){Object(f.a)(a,t);var e=Object(v.a)(a);function a(t){var n;return Object(l.a)(this,a),(n=e.call(this,t)).handleChange=n.handleChange.bind(Object(h.a)(n)),n}return Object(d.a)(a,[{key:"handleChange",value:function(t){var e=t.target.value;"checkbox"===this.props.type&&(e=!this.props.value),this.props.onValueChange(e,this.props.stateIdentifier)}},{key:"render",value:function(){return Object(U.jsxs)("label",{children:[this.props.label,Object(U.jsx)("input",{type:this.props.type,value:this.props.value,onChange:this.handleChange})]})}}]),a}(i.a.Component),at=tt;var nt=function(){return Object(U.jsx)("div",{className:"Input",children:Object(U.jsx)(at,{})})},it=function(t){t&&t instanceof Function&&a.e(3).then(a.bind(null,164)).then((function(e){var a=e.getCLS,n=e.getFID,i=e.getFCP,r=e.getLCP,s=e.getTTFB;a(t),n(t),i(t),r(t),s(t)}))};s.a.render(Object(U.jsx)(i.a.StrictMode,{children:Object(U.jsx)(nt,{})}),document.getElementById("root")),it()}},[[163,1,2]]]);
//# sourceMappingURL=main.57171bd7.chunk.js.map