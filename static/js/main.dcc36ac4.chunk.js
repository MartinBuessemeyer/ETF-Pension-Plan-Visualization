(this["webpackJsonpetf-vis"]=this["webpackJsonpetf-vis"]||[]).push([[0],{117:function(t,e,a){},118:function(t,e,a){},121:function(t,e,a){"use strict";a.r(e);var n=a(5),i=a.n(n),s=a(38),r=a.n(s),o=(a(117),a(118),a(6)),c=a(7),l=a(12),u=a(22),h=a(25),d=a(0),v=a(3),f=a(2),p=a.n(f),g=a(13),m=a(41),b=a.n(m),j=a(4),y=36e5;function O(t,e){return x.apply(this,arguments)}function x(){return(x=Object(g.a)(p.a.mark((function t(e,a){var n;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.c("https://www.alphavantage.co/query?function=TIME_SERIES_MONTHLY_ADJUSTED&symbol=".concat(e,"&apikey=").concat(a,"&datatype=csv"),(function(t){return{timestamp:new Date(t.timestamp.toString()),dividend:parseFloat(t["dividend amount"]),course:parseFloat(t["adjusted close"])}}));case 2:return(n=t.sent).sort((function(t,e){return t.timestamp-e.timestamp})),t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function C(t){return t.map((function(t){return[I(t.timestamp),t.course]}))}function I(t){return Math.floor(t.getTime()/y)}var D=function(){function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7;Object(o.a)(this,t),this.historicalData={},this.predictors={},this.backCastTimeFactor=a,this.apiKey=e;var i=new Date(0);i.setMonth(n),this.backCastTimestampConstant=I(i)}return Object(c.a)(t,[{key:"_loadHistoricalDataIfNotPresent",value:function(){var t=Object(g.a)(p.a.mark((function t(e){var a,n,i,s,r;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e in this.historicalData)){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,O(e);case 4:a=t.sent,n=C(a),i=n[0][0],s=n[n.length-1][0],r=s+(s-i)/this.backCastTimeFactor,this.historicalData[e]={history:a,forecastArray:n,maxTimestampBeforePredictorRepetition:r};case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"_createPredictorIfNotPresent",value:function(t,e){if(t in this.predictors||(this.predictors[t]={}),!(e in this.predictors[t])){var a=this.historicalData[t].forecastArray,n=a[a.length-1][0]-Math.abs(a[a.length-1][0]-e)*this.backCastTimeFactor-this.backCastTimestampConstant,i=a.filter((function(t){return t[0]>=n}));this.predictors[t][e]=b.a.linear(i)}}},{key:"_dateToPredictorTimestampAndDateTimestamp",value:function(t){var e=I(t);return[e>this.maxTimestampBeforePredictorRepetition?this.maxTimestampBeforePredictorRepetition:e,e]}},{key:"predict",value:function(){var t=Object(g.a)(p.a.mark((function t(e,a){var n,i,s,r;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._loadHistoricalDataIfNotPresent(e,this.apiKey);case 2:return n=this._dateToPredictorTimestampAndDateTimestamp(a),i=Object(v.a)(n,2),s=i[0],r=i[1],this._createPredictorIfNotPresent(e,s),t.abrupt("return",this.predictors[e][s].predict(r)[1]);case 5:case"end":return t.stop()}}),t,this)})));return function(e,a){return t.apply(this,arguments)}}()}]),t}(),F=.025,k=.01;function w(t){return[.75*t,.25*t]}var T=function(){function t(e,a,n,i,s,r,c){Object(o.a)(this,t),this.lastYarModelValues=c,this.date=e,this.newInvestmentAmount=n,this.nextDate=a,this.etfIdentifierToRatio=i,this.costFunction=s,this.dividendFunction=r,this.values={costs:c.costs,taxes:c.taxes,inflation:c.inflation,etfs:{}},this.calculate()}return Object(c.a)(t,[{key:"calculate",value:function(){var t=new Date(this.nextDate-this.date),e=t.getFullYear()-new Date(0).getFullYear()+t.getMonth()/12;for(var a in this.lastYarModelValues.etfs){var n=this.etfIdentifierToRatio[a]*this.newInvestmentAmount;this.values.etfs[a]={},this.calculateNextEtfValueAndCosts(a,n,e)}}},{key:"calculateNewInvestmentOfETFAndCosts",value:function(t,e){for(var a=Math.round(12*e),n=t/a,i=this.costFunction(n),s=Object(v.a)(i,2),r=s[0],o=s[1]*a,c=0,l=a;l>0;l--)c+=F*(l/12)*r+r;return[c,o]}},{key:"accumulateDividendAndTaxes",value:function(t){for(var e=this.nextDate.getFullYear()-this.date.getFullYear(),a=0,n=0,i=0;i<e;i++){var s=Math.max(0,e-1-i),r=w(this.dividendFunction(t,this.date.getFullYear()+i)),o=Object(v.a)(r,2),c=o[0],l=o[1];n+=c+c*s*F,a+=l}return[n,a]}},{key:"calculateNextEtfValueAndCosts",value:function(t,e,a){var n=this.lastYarModelValues.etfs[t],i=F*a*n.startCapital+n.startCapital,s=F*a*n.monthlyInvestment,r=F*a*n.dividend,o=this.calculateNewInvestmentOfETFAndCosts(e,a),c=Object(v.a)(o,2),l=c[0],u=c[1],h=this.accumulateDividendAndTaxes(t),d=Object(v.a)(h,2),f=d[0],p=d[1],g=k*i;this.values.inflation+=g,this.values.etfs[t].startCapital=i-g;var m=n.monthlyInvestment+s+l,b=m*k;this.values.inflation+=b,this.values.etfs[t].monthlyInvestment=m-b;var j=n.dividend+f+r,y=j*k;this.values.inflation+=y,this.values.etfs[t].dividend=j-y,this.values.costs+=u,this.values.taxes+=p}},{key:"getD3Representation",value:function(){if(null!=this.d3Representation)return this.d3Representation;var t=this.values.taxes+this.values.costs+this.values.inflation,e=[{height:this.values.inflation,yStart:0,yEnd:0-this.values.inflation,class:"inflation"},{height:this.values.taxes,yStart:-this.values.inflation,yEnd:-this.values.inflation-this.values.taxes,class:"taxes"},{height:this.values.costs,yStart:-this.values.inflation-this.values.taxes,yEnd:-this.values.taxes-this.values.costs-this.values.inflation,class:"costs"}],a=0;for(var n in this.values.etfs){var i=this.values.etfs[n];e.push({height:i.startCapital,yStart:a+i.startCapital,yEnd:a,class:"".concat(n,"_start_capital")}),a+=i.startCapital,e.push({height:i.dividend,yStart:a+i.dividend,yEnd:a,class:"".concat(n,"_dividend")}),a+=i.dividend,e.push({height:i.monthlyInvestment,yStart:a+i.monthlyInvestment,yEnd:a,class:"".concat(n,"_monthly_investment")}),a+=i.monthlyInvestment}return this.d3Representation=[[-t,a],e],this.d3Representation}}],[{key:"getInitialModelValues",value:function(t,e,a){for(var n=a(t),i=Object(v.a)(n,2),s=i[0],r={costs:i[1],taxes:0,inflation:0,etfs:{}},o=0,c=Object.entries(e);o<c.length;o++){var l=Object(v.a)(c[o],2),u=l[0],h=l[1];r.etfs[u]={startCapital:h*s,dividend:0,monthlyInvestment:0}}return r}}]),t}();function M(t,e){var a=t.getMonth()+e,n=a%12,i=t.getFullYear()+Math.floor(a/12);return new Date(i,n)}var P,S=function(){function t(e,a,n,i,s,r){var c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:12;Object(o.a)(this,t),this.startCapital=e,this.investmentPerPeriod=a*c,this.savingPhaseLength=n,this.etfIdentifierToRatio=i,this.costFunction=s,this.age=r,this.intervalLengthInMonths=c,this._calculateTimestampsForVisualization(),this._calculateAllYearModels()}return Object(c.a)(t,[{key:"_calculateTimestampsForVisualization",value:function(){for(var t=function(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:80)-t,n=new Date(0);n.setFullYear((new Date).getFullYear());var i=new Date(0);return i.setFullYear((new Date).getFullYear()+a+e),[n,i]}(this.age),e=Object(v.a)(t,2),a=e[0],n=e[1],i=[],s=a;s<=n;)i.push(s),s=M(s,this.intervalLengthInMonths);this.dates=i,this.nextFutureDate=s}},{key:"_calculateAllYearModels",value:function(){for(var t=this,e=function(e){return.05*t.startCapital},a=T.getInitialModelValues(this.startCapital,this.etfIdentifierToRatio,this.costFunction),n=[new T(this.dates[0],this.dates[1],this.investmentPerPeriod,this.etfIdentifierToRatio,this.costFunction,e,a)],i=0;i<this.dates.length-1;i++){var s=n[n.length-1].values;n.push(new T(this.dates[i],this.dates[i+1],this.investmentPerPeriod,this.etfIdentifierToRatio,this.costFunction,e,s))}this.dates.length>1&&(n.push(new T(this.dates[this.dates.length-1],this.nextFutureDate,this.investmentPerPeriod,this.etfIdentifierToRatio,this.costFunction,e,n[n.length-1].values)),this.yearModels=n)}},{key:"renderVisualization",value:function(t){var e=1e3,a=400,n=j.h(t).append("svg").attr("id","firstSVG").attr("height","100%").attr("width","100%").attr("viewBox","0 0 ".concat(1200," ").concat(480)).append("g").attr("transform","translate(".concat([100,40],")"));console.log(document.querySelector("svg").getBoundingClientRect()),console.log(e,a);for(var i=this.yearModels.map((function(t){return t.getD3Representation()})).map((function(t){return t[0]})),s=j.e(i.map((function(t){return t[0]}))),r=j.d(i.map((function(t){return t[1]}))),o=j.f().domain([s,r]).range([a,0]),c=j.g().domain([this.dates[0],this.nextFutureDate]).range([0,e]),l=e/this.dates.length*.9,u=0;u<this.yearModels.length;u++){var h=this.yearModels[u],d=h.date,v=d.toDateString().split(" ").join("_"),f=h.getD3Representation()[1];console.log(f),n.selectAll("rect.".concat(v)).append("g").attr("class",v).data(f).enter().append("rect").attr("x",c(d)).attr("y",(function(t){return o(t.yStart)})).attr("width",l).attr("height",(function(t){return o(t.yEnd)-o(t.yStart)})).attr("class",(function(t){return t.class})),n.append("g").style("font-size","20px").call(j.b(o)),n.append("g").style("font-size","20px").attr("transform","translate(0, ".concat(a,")")).call(j.a(c)),n.append("g").append("line").attr("x1",c(this.dates[0])).attr("y1",o(0)).attr("x2",c(this.nextFutureDate)).attr("y2",o(0)).attr("stroke-width",1).attr("stroke","black")}}},{key:"updateVisualization",value:function(){}}]),t}(),R=a(1),_="startingCapital",A="monthlyInvestment",Y="transactionCosts",E="savingPhase",V="payoutPhase",N="predict",B="predictOut",z=(P={},Object(d.a)(P,_,"Starting Capital"),Object(d.a)(P,A,"Monthly Investment"),Object(d.a)(P,Y,"Transaction Costs"),Object(d.a)(P,E,"Saving Phase"),Object(d.a)(P,V,"Payout Phase"),Object(d.a)(P,"age","Your Age"),P),L=function(t){Object(u.a)(a,t);var e=Object(h.a)(a);function a(t){var n,s;Object(o.a)(this,a),(s=e.call(this,t)).state=(n={},Object(d.a)(n,_,1e4),Object(d.a)(n,A,100),Object(d.a)(n,Y,5),Object(d.a)(n,E,40),Object(d.a)(n,V,20),Object(d.a)(n,"age",30),Object(d.a)(n,N,new Date("2021-06-01").toISOString().slice(0,10)),Object(d.a)(n,B,0),n),s.forecastModel=new D("demo"),s.handleChange=s.handleChange.bind(Object(l.a)(s));return s.vis=new S(1e4,100,40,{IBM:1},(function(t){return[t-5,5]}),30),console.log(s.vis),s.ref=i.a.createRef(),s}return Object(c.a)(a,[{key:"handleChange",value:function(t,e){this.setState(Object(d.a)({},e,t)),console.log("State ".concat(e," changed value to ").concat(t,"."))}},{key:"componentDidMount",value:function(){this.vis.renderVisualization(this.ref.current)}},{key:"render",value:function(){var t=this;return Object(R.jsxs)(i.a.Fragment,{children:[Object(R.jsx)("form",{children:Object.keys(this.state).map((function(e){return Object(R.jsx)(H,{label:z[e],value:t.state[e],onValueChange:t.handleChange,stateIdentifier:e},e)}))}),Object(R.jsxs)("label",{children:["Predict Date:",Object(R.jsx)("input",{type:"text",value:this.state.predict,onChange:function(e){var a=new Date(e.target.value);t.handleChange(e.target.value,N),null==a||isNaN(a.getTime())||t.forecastModel.predict("IBM",a).then((function(e){return t.handleChange(e,B)}))}},N)]}),Object(R.jsxs)("label",{children:["Prediction:",Object(R.jsx)("p",{children:this.state.predictOut},B)]}),Object(R.jsx)("div",{ref:this.ref})]})}}]),a}(i.a.Component),H=function(t){Object(u.a)(a,t);var e=Object(h.a)(a);function a(t){var n;return Object(o.a)(this,a),(n=e.call(this,t)).state={value:""},n.handleChange=n.handleChange.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"handleChange",value:function(t){this.props.onValueChange(t.target.value,this.props.stateIdentifier)}},{key:"render",value:function(){return Object(R.jsxs)("label",{children:[this.props.label,Object(R.jsx)("input",{type:"text",value:this.props.value,onChange:this.handleChange})]})}}]),a}(i.a.Component),J=L;var q=function(){return Object(R.jsx)("div",{className:"Input",children:Object(R.jsx)(J,{})})},K=function(t){t&&t instanceof Function&&a.e(3).then(a.bind(null,122)).then((function(e){var a=e.getCLS,n=e.getFID,i=e.getFCP,s=e.getLCP,r=e.getTTFB;a(t),n(t),i(t),s(t),r(t)}))};r.a.render(Object(R.jsx)(i.a.StrictMode,{children:Object(R.jsx)(q,{})}),document.getElementById("root")),K()}},[[121,1,2]]]);
//# sourceMappingURL=main.dcc36ac4.chunk.js.map