(this["webpackJsonpetf-vis"]=this["webpackJsonpetf-vis"]||[]).push([[0],{159:function(t,e,a){},160:function(t,e,a){},163:function(t,e,a){"use strict";a.r(e);var n=a(6),r=a.n(n),i=a(49),s=a.n(i),o=(a(159),a(160),a(2)),c=a.n(o),u=a(12),l=a(7),d=a(8),h=a(15),v=a(27),f=a(31),p=a(0),m=a(5),g=a(30),y=a.n(g),b=a(4),x=864e5,P=12;function S(t){return 0===t.getMonth()}function j(t,e){return C.apply(this,arguments)}function C(){return(C=Object(u.a)(c.a.mark((function t(e,a){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.c("https://www.alphavantage.co/query?function=TIME_SERIES_MONTHLY_ADJUSTED&symbol=".concat(e,"&apikey=").concat(a,"&datatype=csv"),(function(t){return{date:new Date(t.timestamp.toString()),dividend:parseFloat(t["dividend amount"]),course:parseFloat(t["adjusted close"])}}));case 2:return(n=t.sent).sort((function(t,e){return t.date-e.date})),t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function O(t){return t.map((function(t){return[w(t.date),t.course]}))}function T(t){var e=t[0].date.getFullYear(),a=[[e,0]];return t.forEach((function(t){t.date.getFullYear()===e?a[a.length-1][1]+=t.dividend:(e=t.date.getFullYear(),a.push([e,t.dividend]))})),a.sort((function(t,e){return t[0]-e[0]})),a}function w(t){return Math.floor(t.getTime()/x)}var M=function(){function t(){Object(l.a)(this,t),this.historicalData={},this.coursePredictors={},this.dividendPredictors={}}return Object(d.a)(t,[{key:"loadAndCacheHistoricalETFData",value:function(){var e=Object(u.a)(c.a.mark((function e(a){var n,r,i,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a in this.historicalData)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,j(a);case 4:n=e.sent,r=O(n),i=t._calculateMaxTimestampBeforePredictorRepetition(r),s=T(n),o=t._calculateMaxTimestampBeforePredictorRepetition(s),this.historicalData[a]={history:n,courseForecastArray:r,dividendForecastArray:s},this.coursePredictors[a]={maxTimestampBeforeCoursePredictorRepetition:i},this.dividendPredictors[a]={maxYearBeforeDividendPredictorRepetition:o};case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCoursePredictorIfNotPresent",value:function(e,a){if(!(a in this.coursePredictors[e])){var n=this.historicalData[e].courseForecastArray,r=n[n.length-1][0]-Math.abs(n[n.length-1][0]-a)*t.backCastTimeFactor-t.backCastTimestampConstant,i=n.filter((function(t){return t[0]>=r}));this.coursePredictors[e][a]=y.a.linear(i,{order:2,precision:20})}}},{key:"_courseDateToPredictorTimestampAndDateTimestamp",value:function(t,e){var a=w(t);return[a>this.coursePredictors[e].maxTimestampBeforeCoursePredictorRepetition?this.coursePredictors[e].maxTimestampBeforeCoursePredictorRepetition:a,a]}},{key:"_createDividendPredictorIfNotPresent",value:function(e,a){if(!(a in this.dividendPredictors[e])){var n=this.historicalData[e].dividendForecastArray,r=n[n.length-1][0]-Math.abs(n[n.length-1][0]-a)*t.backCastTimeFactor-t.backCastTimestampConstant,i=n.filter((function(t){return t[0]>=r}));this.dividendPredictors[e][a]=y.a.linear(i,{order:2,precision:20})}}},{key:"_dividendYearToPredictorYear",value:function(t,e){return this.dividendPredictors[t].maxYearBeforeDividendPredictorRepetition<e?this.dividendPredictors[t].maxYearBeforeDividendPredictorRepetition:e}},{key:"predictCourse",value:function(t,e){if(!(t in this.coursePredictors))throw"First call loadHistoricalDataIfNotPresent() before predicting: ".concat(t);var a=this._courseDateToPredictorTimestampAndDateTimestamp(e,t),n=Object(m.a)(a,2),r=n[0],i=n[1];return this._createCoursePredictorIfNotPresent(t,r),this.coursePredictors[t][r].predict(i)[1]}},{key:"predictDividend",value:function(t,e){if(!(t in this.dividendPredictors))throw"First call loadHistoricalDataIfNotPresent() before predicting: ".concat(t);var a=this._dividendYearToPredictorYear(t,e);return this._createDividendPredictorIfNotPresent(t,a),Math.max(0,this.dividendPredictors[t][a].predict(e)[1])}}],[{key:"configure",value:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7;t.apiKey=e,t.backCastTimeFactor=a;var r=new Date(0);if(r.setMonth(n),t.backCastTimestampConstant=w(r),null!=t.instance){var i=t.getInstance();for(var s in i.coursePredictors)i.coursePredictors[s]={maxTimestampBeforeCoursePredictorRepetition:t._calculateMaxTimestampBeforePredictorRepetition(i.historicalData[s].courseForecastArray)};for(var o in i.dividendPredictors)i.dividendPredictors[o]={maxYearBeforeDividendPredictorRepetition:t._calculateMaxTimestampBeforePredictorRepetition(i.historicalData[o].dividendForecastArray)}}}},{key:"getInstance",value:function(){return null==t.instance&&(t.instance=new t),t.instance}},{key:"_calculateMaxTimestampBeforePredictorRepetition",value:function(e){var a=e[0][0],n=e[e.length-1][0];return n+(n-a)/t.backCastTimeFactor}}]),t}();M.instance=null,M.apiKey=null,M.backCastTimeConstant=null,M.backCastTimeFactor=null;var F=M,I=a(1),k=a(9),D=.26375;function _(t){var e=new Date(t);return e.setMonth(t.getMonth()+1),e}function R(t,e){return function(t){return 11===t.getMonth()}(e)?F.getInstance().predictDividend(t,e.getFullYear()):0}function N(t,e){var a=t*e.percentageCosts+e.fixedCosts,n=Math.max(t-a,0);return[n,a=t-n]}function A(t,e){return[Math.max(0,t-e),Math.max(0,e-t)]}function Y(t,e){return e.totalShares[t]*e.sharePrizes[t]}function B(t,e){return e.newShares[t]*e.sharePrizes[t]}function z(t,e,a,n,r){var i=F.getInstance(),s=0,o=t[t.length-1],c={date:a,newShares:{},totalShares:Object(k.a)({},o.totalShares),dividendNewShares:{},dividendTotalShares:Object(k.a)({},o.dividendTotalShares),totalCosts:o.totalCosts,sharePrizes:{},totalInvestedMoney:Object(k.a)({},o.totalInvestedMoney),totalTaxes:o.totalTaxes,totalPayout:Object(k.a)({},o.totalPayout),newPayout:{}};for(var u in n){var l=N(n[u]*e,r.costConfig),d=Object(m.a)(l,2),h=d[0];s+=d[1],c.totalInvestedMoney[u]+=h;var v=i.predictCourse(u,a),f=h/v;c.sharePrizes[u]=v,c.newShares[u]=f;var p=R(u,a),g=c.totalShares[u]*p/v;c.newShares[u]+=g,c.dividendNewShares[u]=g,c.dividendTotalShares[u]+=g,c.totalShares[u]+=c.newShares[u],c.newPayout[u]=0}c.totalCosts+=s;var y=function(t,e,a,n){if(!S(e)||t.length<2)return[0,a];var r,i,s,o=0,c=t[t.length-1],u=t.length-P>1?t[t.length-P]:t[1];for(var l in n){for(var d=0,h=1;h<P&&t.length-h>0;h++)d+=B(l,t[t.length-h])*h/P;d+=Y(l,u)*(P-u.date.getMonth())/P,d*=.0049;var v=Y(l,c)-c.totalInvestedMoney[l],f=0;t.length>P&&(f=Math.max(0,Y(l,t[t.length-1-P])-t[t.length-1-P].totalInvestedMoney[l]));var p=(r=v-f,i=0,s=d,Math.max(i,Math.min(r,s))),g=A(p,a),y=Object(m.a)(g,2);p=y[0],a=y[1],o+=.7*p*D}return[o,a]}(t,a,r.taxFreeAmount,n),b=Object(m.a)(y,2),x=b[0],j=b[1];return c.totalTaxes+=x,t.push(c),j}function E(t,e,a,n,r,i,s,o){S(n)&&(s=r.taxFreeAmount);var c=F.getInstance(),u=0,l=0,d=t[t.length-1],h={date:n,newShares:{},totalShares:Object(k.a)({},d.totalShares),dividendNewShares:{},dividendTotalShares:Object(k.a)({},d.dividendTotalShares),totalCosts:d.totalCosts,sharePrizes:{},totalInvestedMoney:Object(k.a)({},d.totalInvestedMoney),totalTaxes:d.totalTaxes,totalPayout:Object(k.a)({},d.totalPayout),newPayout:{}};for(var v in a){var f=c.predictCourse(v,n);if(h.sharePrizes[v]=f,h.newPayout[v]=0,o[v].investmentStepsIdx<t.length){for(var p=e*a[v],g=0,y=N(p,r.costConfig)[1],b=0,x=o[v].investmentStepsIdx,P=t[x].newShares[v]-o[v].alreadySoldShares;x<t.length;x++){var j=p-g,C=t[x],O=f*(x===o[v].investmentStepsIdx?C.newShares[v]-o[v].alreadySoldShares:C.newShares[v]),T=Math.min(O,j),w=T/f;P=C.newShares[v]-w,P-=x===o[v].investmentStepsIdx?o[v].alreadySoldShares:0;var M=Math.max(0,T-(y-b));b+=Math.max(0,T-M);var I=w*C.sharePrizes[v],_=Math.max(0,M-I),Y=A(_,s),B=Object(m.a)(Y,2);_=B[0],s=B[1];var z=.7*_*D,E=A(z,i),L=Object(m.a)(E,2);z=L[0],i=L[1],l+=z;var H=M-z;h.newPayout[v]+=H,h.totalPayout[v]+=H,h.totalShares[v]-=w,g+=T;var V=0;V=x===o[v].investmentStepsIdx?Math.max(0,C.dividendNewShares[v]-o[v].alreadySoldShares):C.dividendNewShares[v];var J=Math.min(V,w);if(h.dividendTotalShares[v]-=J,g>=p)break}u+=b,o[v].investmentStepsIdx=x,o[v].investmentStepsIdx+=0===P?1:0,o[v].alreadySoldShares=x<t.length?t[x].newShares[v]-P:0}var U=h.totalShares[v]*R(v,n)/f;h.newShares[v]=U,h.totalShares[v]+=U,h.dividendNewShares[v]=U,h.dividendTotalShares[v]+=U}return h.totalCosts+=u,h.totalTaxes+=l,t.push(h),[i,s]}function L(t,e){var a=F.getInstance(),n={date:e,totalCosts:0,totalTaxes:0,newShares:{},totalShares:{},dividendNewShares:{},dividendTotalShares:{},totalInvestedMoney:{},totalPayout:{},newPayout:{},sharePrizes:{}};for(var r in t)n.newShares[r]=0,n.totalShares[r]=0,n.dividendNewShares[r]=0,n.dividendTotalShares[r]=0,n.totalInvestedMoney[r]=0,n.totalPayout[r]=0,n.newPayout[r]=0,n.sharePrizes[r]=a.predictCourse(r,e);return n}var H,V=function(){function t(e,a,n,r,i,s,o,c){Object(l.a)(this,t),this.startCapital=e,this.monthlyInvestment=a,this.monthlyPayout=n,this.savingPhaseLength=r,this.etfToRatio=i,this.configOptions=s,this.expectationOfLife=c,this.age=o,this._calculateTimestampsForModel(),this._calculateModel()}return Object(d.a)(t,[{key:"_calculateTimestampsForModel",value:function(){for(var t=function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,r=e-t,i=new Date,s=new Date(i.getFullYear(),i.getMonth()+1),o=new Date(s);o.setFullYear(s.getFullYear()+a);var c=new Date(s);return c.setFullYear(s.getFullYear()+r+n),[s,o,c]}(this.age,this.expectationOfLife,this.savingPhaseLength),e=Object(m.a)(t,3),a=e[0],n=e[1],r=e[2],i=[],s=a;s<n;s=_(s))i.push(s);this.savingDates=i;for(var o=[],c=n;c<r;c=_(c))o.push(c);this.payoutDates=o}},{key:"_calculateModel",value:function(){var t,e=[L(this.etfToRatio,this.savingDates[0])],a=z(e,this.monthlyInvestment+this.startCapital,this.savingDates[0],this.etfToRatio,this.configOptions),n=Object(I.a)(this.savingDates.slice(1));try{for(n.s();!(t=n.n()).done;){var r=t.value;a=z(e,this.monthlyInvestment,r,this.etfToRatio,this.configOptions)}}catch(v){n.e(v)}finally{n.f()}var i=(e=e.slice(1))[e.length-1].totalTaxes,s={};for(var o in this.etfToRatio)s[o]={investmentStepsIdx:0,alreadySoldShares:0};var c,u=Object(I.a)(this.payoutDates);try{for(u.s();!(c=u.n()).done;){var l=c.value,d=E(e,this.monthlyPayout,this.etfToRatio,l,this.configOptions,i,a,s),h=Object(m.a)(d,2);i=h[0],a=h[1]}}catch(v){u.e(v)}finally{u.f()}this.investmentSteps=e}}]),t}(),J=function(){function t(){Object(l.a)(this,t)}return Object(d.a)(t,[{key:"render",value:function(t,e){e.innerHTML="";var a=b.j(e).append("svg").attr("id","firstSVG").attr("height","100%").attr("width","100%").attr("viewBox","0 0 ".concat(1300," ").concat(480)).append("g").attr("transform","translate(".concat([150,40],")")),n={costs:0,taxes:1,inflation:2},r=3,i="capital",s="dividend";for(var o in t[0].totalShares)n[o+s]=r++,n[o+i]=r++;for(var c=[],u=0;u<r;u++)c.push([]);var l,d=Object(I.a)(t);try{for(d.s();!(l=d.n()).done;){var h=l.value;c[n.costs].push({value:-h.totalCosts,date:h.date}),c[n.taxes].push({value:-h.totalCosts-h.totalTaxes,date:h.date}),c[n.inflation].push({value:-h.totalCosts-h.totalTaxes,date:h.date});var v=0;for(var f in h.totalShares){var p=Y(f,h),m=h.dividendTotalShares[f]*h.sharePrizes[f];c[n[f+i]].push({value:p+v,date:h.date}),c[n[f+s]].push({value:p-m+v,date:h.date}),v+=p}}}catch(O){d.e(O)}finally{d.f()}for(var g in c[n.inflation].cssClass="inflation",c[n.taxes].cssClass="taxes",c[n.costs].cssClass="costs",t[0].totalShares)c[n[g+s]].cssClass="".concat(g,"_dividend"),c[n[g+i]].cssClass="".concat(g,"_total_amount");var y=b.g(c[n.inflation].map((function(t){return t.value}))),x=b.f(c[c.length-1].map((function(t){return t.value}))),P=b.h().domain([y,x]).range([400,0]),S=b.d(c[0],(function(t){return t.date})),j=b.i().domain(S).range([0,1e3]);a.append("g").style("font-size","20px").call(b.b(P).tickFormat((function(t){return"".concat(t.toLocaleString()," EUR")}))),a.append("g").style("font-size","20px").attr("transform","translate(0, ".concat(400,")")).call(b.a(j)),a.append("g").append("line").attr("x1",j(S[0])).attr("y1",P(0)).attr("x2",j(S[1])).attr("y2",P(0)).attr("stroke-width",3).attr("stroke","black");for(var C=0;C<c.length;C++)a.append("path").datum(c[C]).attr("fill","none").attr("class",(function(t){return t.cssClass})).attr("stroke-width",3).attr("d",b.e().x((function(t){return j(t.date)})).y((function(t){return P(t.value)})))}}]),t}(),U=a(3),K="startingCapital",q="monthlyInvestment",G="transactionCosts",Q="transactionCostsType",W="savingPhase",X="age",Z="taxFreeAmount",$="monthlyPayout",tt="lifeExpectation",et=(H={},Object(p.a)(H,K,"Starting Capital"),Object(p.a)(H,q,"Monthly Investment"),Object(p.a)(H,G,"Transaction Costs"),Object(p.a)(H,Q,"Fixes Amount ?"),Object(p.a)(H,W,"Saving Phase"),Object(p.a)(H,X,"Your Age"),Object(p.a)(H,Z,"Tax Free Amount"),Object(p.a)(H,$,"Monthly Payout"),Object(p.a)(H,tt,"Life Expectation"),H);function at(t,e){var a=parseInt(t.target.value);return isNaN(a)?0:a}function nt(t,e){var a=parseFloat(t.target.value);return isNaN(a)?0:a}function rt(t,e){return!e.props.value}var it=function(t){Object(v.a)(a,t);var e=Object(f.a)(a);function a(t){var n,i;return Object(l.a)(this,a),(i=e.call(this,t)).state=(n={},Object(p.a)(n,K,{value:1e4,type:"text",transformFunction:at}),Object(p.a)(n,q,{value:100,type:"text",transformFunction:at}),Object(p.a)(n,$,{value:1e3,type:"text",transformFunction:at}),Object(p.a)(n,G,{value:.005,type:"text",transformFunction:nt}),Object(p.a)(n,Q,{value:!1,type:"checkbox",transformFunction:rt}),Object(p.a)(n,W,{value:40,type:"text",transformFunction:at}),Object(p.a)(n,X,{value:30,type:"text",transformFunction:at}),Object(p.a)(n,Z,{value:801,type:"text",transformFunction:at}),Object(p.a)(n,tt,{value:80,type:"text",transformFunction:at}),n),i.ref=r.a.createRef(),i.handleChange=i.handleChange.bind(Object(h.a)(i)),i}return Object(d.a)(a,[{key:"handleChange",value:function(t,e){this.state[e].value=t,this.setState(this.state),console.log("State ".concat(e," changed value to ").concat(t,"."))}},{key:"getVisualizationModel",value:function(){return new V(this.state.startingCapital.value,this.state.monthlyInvestment.value,this.state.monthlyPayout.value,this.state.savingPhase.value,{IBM:1},{taxFreeAmount:this.state.taxFreeAmount.value,costConfig:(t=this.state,t.transactionCostsType.value?{percentageCosts:0,fixedCosts:t.transactionCosts.value}:{percentageCosts:t.transactionCosts.value,fixedCosts:0})},this.state.age.value,this.state.lifeExpectation.value);var t}},{key:"componentDidMount",value:function(){var t=Object(u.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return F.configure("demo"),this.forecastModel=F.getInstance(),t.next=4,this.forecastModel.loadAndCacheHistoricalETFData("IBM");case 4:(new J).render(this.getVisualizationModel().investmentSteps,this.ref.current);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){(new J).render(this.getVisualizationModel().investmentSteps,this.ref.current)}},{key:"render",value:function(){var t=this;return Object(U.jsxs)(r.a.Fragment,{children:[Object(U.jsx)("form",{children:Object.keys(this.state).map((function(e){return Object(U.jsx)(st,{label:et[e],value:t.state[e].value,type:t.state[e].type,onValueChange:t.handleChange,stateIdentifier:e,transformFunction:t.state[e].transformFunction},e)}))}),Object(U.jsx)("div",{ref:this.ref})]})}}]),a}(r.a.Component),st=function(t){Object(v.a)(a,t);var e=Object(f.a)(a);function a(t){var n;return Object(l.a)(this,a),(n=e.call(this,t)).handleChange=n.handleChange.bind(Object(h.a)(n)),n}return Object(d.a)(a,[{key:"handleChange",value:function(t){t.target.value;"checkbox"===this.props.type&&this.props.value,this.props.onValueChange(this.props.transformFunction(t,this),this.props.stateIdentifier)}},{key:"render",value:function(){return Object(U.jsxs)("label",{children:[this.props.label,Object(U.jsx)("input",{type:this.props.type,value:this.props.value,onChange:this.handleChange})]})}}]),a}(r.a.Component),ot=it;var ct=function(){return Object(U.jsx)("div",{className:"Input",children:Object(U.jsx)(ot,{})})},ut=function(t){t&&t instanceof Function&&a.e(3).then(a.bind(null,164)).then((function(e){var a=e.getCLS,n=e.getFID,r=e.getFCP,i=e.getLCP,s=e.getTTFB;a(t),n(t),r(t),i(t),s(t)}))};s.a.render(Object(U.jsx)(r.a.StrictMode,{children:Object(U.jsx)(ct,{})}),document.getElementById("root")),ut()}},[[163,1,2]]]);
//# sourceMappingURL=main.52fcc405.chunk.js.map